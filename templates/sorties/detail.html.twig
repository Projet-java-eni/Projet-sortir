{% extends 'base.html.twig' %}

{% block title %}Détail de la sortie{% endblock %}

{% block body %}
    <h2 class="libelle">{{ sortie.nom }}</h2>

    <div>Date : le {{ sortie.dateDebut|date("d/m/Y")}}, de {{ sortie.heureDebut|date('H:i') }} à {{ sortie.heureFin|date('H:i') }}</div>
    <div>Thématique : {{ sortie.theme.theme }}</div>
    <div>Lieu : {{ sortie.lieu.nom }} à {{ sortie.lieu.ville.nom }}</div>
    <div>Description : {{ sortie.infosSortie }}</div>

    <div>Nombre maximal de participants : {{ sortie.limiteParticipants }}</div>
    <div>Nombre d'inscrits : {{ sortie.participants|length }}

        {% if sortie.participants.count %}

            ({% for participant in sortie.participants %}
            <a href="{{ path('user_show', {'id': participant.id}) }}">
                {{ participant.friendlyName }}
            </a>
            {% if not loop.last %}, {% endif %}
        {% endfor %})

        {% endif %}

    </div>
    <div>Nombre de places restantes : {{ sortie.limiteParticipants-sortie.participants|length }} / {{ sortie.limiteParticipants }}</div>
    <div>Date limite d'inscription : {{ sortie.dateCloture|date("d/m/Y") }}</div>

    {% if sortie.dateCloture|date('d - m -Y') < 'now'|date('d - m -Y') %}
        <h3>La date limite d'inscription est dépassée</h3>
    {% else %}

        {% if sortie.participants|length >= sortie.limiteParticipants %}
            <h3>Il n'y plus de places disponibles</h3>
        {% else %}

            {% if app.user %}

                {#  Si déjà inscrit, pouvoir se désinscrire #}
                {% if app.user.sortiesParticipees.contains(sortie) %}

                    <h3>Vous êtes inscrit à cette sortie</h3>
                    {{ form(desinscriptionSortieForm) }}

                  {% else %}
                    {# Sinon pouvoir s'inscrire #}
                    {{ form(inscriptionSortieForm) }}

                {% endif %}

            {% else %}
                <h3>Pour pouvoir s'inscrire, veuillez vous connecter à votre compte utilisateur</h3>
                <li><a href="{{ path('app_login') }}" title="Se connecter">Se connecter</a> </li>
                <li><a href="{{ path('app_register') }}" title="S'inscrire'">Créer un compte</a> </li>
            {% endif %}

        {% endif %}

    {% endif %}

{% endblock %}